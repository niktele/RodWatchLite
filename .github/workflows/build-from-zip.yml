- name: Setup Android SDK
  uses: android-actions/setup-android@v3
  with:
    accept-android-sdk-licenses: true

# Stabilna instalacija sa retry-jem
- name: Install Android packages (retry)
  shell: bash
  run: |
    set -euo pipefail
    SDKM="$ANDROID_SDK_ROOT/cmdline-tools/$(ls -1 $ANDROID_SDK_ROOT/cmdline-tools | head -n1)/bin/sdkmanager"
    # ponekad je 'latest' ili broj verzije; gore to rešavamo dinamički
    echo "sdkmanager at: $SDKM"
    # do 3 pokušaja (zbog povremenih 500/timeout grešaka)
    for attempt in 1 2 3; do
      if "$SDKM" --sdk_root="$ANDROID_SDK_ROOT" --install "platform-tools" "platforms;android-34" "build-tools;34.0.0"; then
        break
      fi
      echo "sdkmanager failed (attempt $attempt). Sleeping 10s and retrying…"
      sleep 10
      if [[ $attempt == 3 ]]; then exit 1; fi
    done
